<?xml version="1.0" encoding="UTF-8"?>
<project name="git">
    <!--
     A rule to extract a string that represents the current revision
     in the active git repository. This is either a short commit hash
     or the active tag. From http://stackoverflow.com/a/4059546/90934
     by StackOverflow user jmuc.
    -->
    <available file=".git" type="dir" property="present"/>

    <!-- Note: the variable set by this will not be namespaced if include is used. -->
    <target name="revision" description="Store git revision in ${repository.version}">
        <exec executable="git" outputproperty="revision" failifexecutionfails="false" errorproperty="">
            <arg value="describe"/>
            <arg value="--tags"/>
            <arg value="--always"/>
            <arg value="HEAD"/>
        </exec>
        <condition property="repository.version" value="${revision}" else="unknown">
            <and>
                <isset property="revision"/>
                <length string="${revision}" trim="yes" length="0" when="greater"/>
            </and>
        </condition>
    </target>
</project>
